---
title: å†™å†™é«˜æ–¯æ¨¡ç³Šâ€”â€”ä» CSS æ¨¡ç³Šæ»¤é•œçš„ç™½è¾¹è¯´èµ·
date: 2020-10-18 22:04:45
updated: 2020-10-22 22:04:45
katex: true
tags:
  - é«˜æ–¯æ¨¡ç³Š
  - Canvas
  - CSS
categories:
  - äº‘æ¸¸çš„å°ç¬”è®°
---

## å‰è¨€

é€šå¸¸æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨ PhotoShop ä¸­çš„ã€Œé«˜æ–¯æ¨¡ç³Šã€æ¥æ¨¡ç³Šå›¾ç‰‡ã€‚

è¿™ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„è‰ºæœ¯æ•ˆæœï¼Œè‹¹æœæƒ¯ç”¨çš„æ¯›ç»ç’ƒæ•ˆæœæœ¬è´¨ä¾¿æ˜¯é«˜æ–¯æ¨¡ç³Šï¼Œè€Œæˆ‘ä»¬å°†å›¾ç‰‡æ¨¡ç³Šåä½œä¸ºç½‘ç«™èƒŒæ™¯ï¼Œæ—¢å‡å°äº†å›¾ç‰‡çš„ä½“ç§¯ï¼Œä¹Ÿèƒ½åˆ«æœ‰ä¸€ç•ªé£å‘³ã€‚ï¼ˆè­¬å¦‚å’±ç«™ç‚¹çš„èƒŒæ™¯ä¹Ÿæ˜¯é«˜æ–¯æ¨¡ç³Šåçš„äº§ç‰©ã€‚ï¼‰

![Gaussian Blur | Photoshop](https://r2.yunyoujun.cn/images/photoshop-gaussian-blur.jpg)

è€Œ CSS3 æä¾›äº†æ»¤é•œ [filter](https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter)/[backdrop-filter](https://developer.mozilla.org/zh-CN/docs/Web/CSS/backdrop-filter)ï¼Œå…¶ä¸­çš„æ¨¡ç³ŠåŠŸèƒ½åŒæ ·ä¹Ÿæ˜¯é«˜æ–¯æ¨¡ç³Šã€‚ï¼ˆCanvas ä¸­çš„ [filter](https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/filter) äº¦æ˜¯å¦‚æ­¤ã€‚ï¼‰

åªæ˜¯å½“æˆ‘ä»¬ä¸ºå›¾ç‰‡èƒŒæ™¯æ·»åŠ  CSS æ»¤é•œæ—¶ï¼Œä¾¿ä¼šå‡ºç°ä¸å’Œè°çš„ç™½è¾¹ã€‚

è™½ç„¶æœ‰ä¸€äº›å¥‡æŠ€æ·«å·§ï¼ˆæ¯”å¦‚æ”¾å¤§å›¾ç‰‡å†æˆªå»æ¨¡ç³Šçš„è¾¹ï¼‰å»è§£å†³ï¼Œä½†çš†æ²»æ ‡ä¸æ²»æœ¬ï¼Œæˆ‘ä»¬ä¸å¦¨å€Ÿæ­¤æœºä¼šæ¢ç©¶ä¸€ä¸‹é«˜æ–¯æ¨¡ç³Šï¼Œå¹¶å°è¯•è‡ªå·±å®ç°å®ƒã€‚

æ­£æ–‡**å¤šå›¾é¢„è­¦**

<!-- more -->

## ç®€ä»‹

é«˜æ–¯æ¨¡ç³Šçœ‹ä¸€ä¸‹[ç»´åŸºç™¾ç§‘](https://zh.wikipedia.org/wiki/%E9%AB%98%E6%96%AF%E6%A8%A1%E7%B3%8A)ä¾¿èƒ½äº†è§£ä¸ªä¸€äºŒã€‚ä¸è¿‡ä¸­æ–‡ç»´åŸºç™¾ç§‘ç›¸æ¯”è‹±æ–‡ç™¾ç§‘æ¼äº†å‡ æ¡ç®€ä»‹ã€‚

é«˜æ–¯ï¼ˆCarl Friedrich Gaussï¼‰ï¼Œæ²¡é”™ï¼Œå°±æ˜¯æˆ‘ä»¬å¹³å¸¸çŸ¥é“çš„é‚£ä½é«˜æ–¯ï¼Œæ˜¯å†å²ä¸Šæœ€ä¸ºçŸ¥åã€æœ€ä¸ºé‡è¦çš„æ•°å­¦å®¶ä¹‹ä¸€ã€‚è€Œé«˜æ–¯æ¨¡ç³Šæœ¬èº«å¹¶éç”±å®ƒæå‡ºï¼Œè€Œæ˜¯è¿™ä¸ªç®—æ³•æœ¬èº«ä½¿ç”¨äº†é«˜æ–¯åˆ†å¸ƒï¼ˆä¹Ÿå°±æ˜¯æ¦‚ç‡è®ºä¸­çš„[æ­£æ€åˆ†å¸ƒ](https://zh.wikipedia.org/wiki/%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83)ï¼‰ã€‚

$$ {\displaystyle f(x)={\frac {1}{\sigma {\sqrt {2\pi }}}}e^{-{\frac {\left(x-\mu \right)^{2}}{2\sigma ^{2}}}}} $$

> çœ‹åˆ°å…¬å¼ä¸è¦æ€•ï¼Œæˆ‘ä»¬åªè¦ä¼šç”¨å®ƒã€‚

ä¸è¿‡ï¼Œé«˜æ–¯åˆ†å¸ƒä¹Ÿå¹¶éç”±é«˜æ–¯æå‡ºï¼Œå…¶æœ€å…ˆç”±å¾·å›½çš„æ•°å­¦å®¶å’Œå¤©æ–‡å­¦å®¶æ££è«å¼—ï¼ˆAbraham de Moivreï¼‰äº 1733 å¹´é¦–æ¬¡æå‡ºï¼Œè€Œé«˜æ–¯æœ€å…ˆå°†å…¶åº”ç”¨äºäº†å¤©æ–‡å­¦ç ”ç©¶ï¼Œå½±å“æ·±è¿œã€‚

## å®éªŒ

å¯¹äº†ï¼Œå’±å‰é¢æåˆ°å›¾ç‰‡ä½“ç§¯å¯ä»¥å‹ç¼©å¾—æ›´å°ã€‚å˜›ï¼Œè™½ç„¶æ˜¯ç†æ‰€å½“ç„¶çš„äº‹æƒ…ï¼Œä½†æ˜¯æœ¬ç€ä¸¥è°¨èµ·è§ï¼Œè¿˜æ˜¯ç”¨æ•°æ®è¯´è¯ã€‚

åŒä¸€å¼ å›¾ç‰‡æ¨¡ç³Šå‰åï¼Œå¹¶ä½¿ç”¨ [Squoosh](https://squoosh.app/) å‹ç¼©ã€‚

![æ¨¡ç³Šå](https://r2.yunyoujun.cn/images/a-image-after-blur.jpg)_589\*600 blur:30px æ¨¡ç³Šå 7.15KB_

![æ¨¡ç³Šå‰](https://r2.yunyoujun.cn/images/a-image-before-blur.jpg)_589\*600 æ¨¡ç³Šå‰ 29.71KB_

æ­¤å¤–ï¼ŒCSS æ»¤é•œæœ¬èº«è¿˜æ˜¯æŒºå æ€§èƒ½çš„ï¼ˆSafari å¥½åƒä¼˜åŒ–çš„æ›´å¥½ä¸€äº›ï¼Ÿï¼‰ï¼Œä¹‹å‰å†™[ä¸»é¢˜](https://github.com/YunYouJun/hexo-theme-yun)å°è¯•åŠ äº†ä¸€å †æ¨¡ç³Šæ•ˆæœï¼Œè™½ç„¶æŒºå¥½çœ‹çš„ï¼Œä½†æ˜¯å‘ç°é£æ‰‡å—¡å—¡å“ï¼Œæœ€ç»ˆè¿˜æ˜¯å¿ç—›å‰²çˆ±ã€‚

ä¸è¿‡è¿˜æœ‰ä»¶ç¥å¥‡çš„äº‹æƒ…ã€‚ğŸ¤”ï¸ Photoshop å¤„ç†çš„å›¾ç‰‡ä¸ºä»€ä¹ˆå°±æ²¡æœ‰ç™½è¾¹å‘¢ï¼Ÿ

ï¼ˆåä¸¤å¼ æ˜¯ç½‘é¡µä¸­çš„æ•ˆæœï¼Œä½ å¯èƒ½ä¼šå‘ç°åè€…æ¯” PhotoShop æ¨¡ç³Šçš„å‰å®³ï¼Œå•çº¯å› ä¸ºæˆ‘åœ¨ç½‘é¡µä¸­ç¼©å°äº†å›¾ç‰‡å†æ¨¡ç³Šä»¥æ–¹ä¾¿æˆªå›¾ã€‚æœ¬è´¨æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ï¼‰

> çº¢è‰²è¾¹æ¡†æ˜¯åŸæœ¬å›¾ç‰‡æ‰€åœ¨çš„èŒƒå›´ã€‚

![åŸå›¾](https://r2.yunyoujun.cn/images/blur-source-image.jpg)_åŸå›¾_

![Photoshop é«˜æ–¯æ¨¡ç³Š 30px](https://r2.yunyoujun.cn/images/photoshop-gaussian-blur-30px.jpg)_2419\*1209 Photoshop é«˜æ–¯æ¨¡ç³Š 30px_

![CSS filter ç™½è‰²èƒŒæ™¯](https://r2.yunyoujun.cn/images/css-filter-white-30px.jpg)_1119\*559 CSS filter é«˜æ–¯æ¨¡ç³Š 30px ç™½è‰²èƒŒæ™¯_

![CSS filter é»‘è‰²èƒŒæ™¯](https://r2.yunyoujun.cn/images/css-filter-black-30px.jpg)_1119\*559 CSS filter é«˜æ–¯æ¨¡ç³Š 30px é»‘è‰²èƒŒæ™¯_

æˆ‘ä»¬å¯ä»¥å‘ç° CSS filter æ¨¡ç³Šåçš„è¾¹ç•Œï¼Œå‡†ç¡®æ¥è¯´å¹¶ä¸æ˜¯ç™½è¾¹ã€‚è€Œæ˜¯é€æ˜çš„ï¼Œæˆ‘ä»¬åº”å½“å«å®ƒé€æ˜è¾¹æˆ–è€… Alpha è¾¹æ›´ä¸ºåˆé€‚ã€‚

## çŒœæµ‹

é«˜æ–¯æ¨¡ç³Šæœ¬è´¨æ˜¯æ ¹æ®è®¾å®šçš„æ¨¡ç³ŠèŒƒå›´ï¼ˆ30px ä¾¿æ˜¯æ¨¡ç³ŠåŠå¾„ä¸º 30 åƒç´ ï¼‰ï¼Œéšåæ ¹æ®æ­£æ€ï¼ˆé«˜æ–¯ï¼‰åˆ†å¸ƒè®¡ç®—å‡ºä¸€ä¸ªæƒé‡çŸ©é˜µï¼Œå› ä¸ºè¦ä¿è¯æƒé‡ä¹‹å’Œä¸º 1ï¼Œæ‰€ä»¥å†è¿›è¡Œå½’ä¸€åŒ–ï¼Œå†å°†å…¶æ”¾åˆ°å›¾ç‰‡è¿›è¡Œè®¡ç®—ï¼ˆå°†å›¾ç‰‡ä¸­çš„ä¸€ä¸ªåƒç´ ä»¥åŠå…¶æ¨¡ç³ŠåŠå¾„ä¸­çš„åƒç´ è¿›è¡ŒåŠ æƒæ±‚å’Œï¼‰å¾—åˆ°æ¨¡ç³Šåçš„åƒç´ ã€‚ï¼ˆå½©è‰²å›¾ç‰‡åˆ™ RGB ä¸‰é€šé“åˆ†åˆ«è®¡ç®—ï¼Œå¸¦ Alpha é€šé“åŒç†ã€‚ï¼‰

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„çŒœæµ‹ï¼Œåœ¨æ¨¡ç³Šçš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨åº”è¯¥æ˜¯æŠŠå‘¨å›´ç¼ºå°‘çš„åƒç´ è¡¥è¶³ä¸ºå®Œå…¨é€æ˜çš„åƒç´ æ¥è®¡ç®—é«˜æ–¯æ¨¡ç³Šã€‚

è€Œ Photoshop åˆ™å¯èƒ½åªå°†é™„è¿‘æœ‰çš„åƒç´ å‚ä¸åŠ æƒå¹³å‡ã€æˆ–æ˜¯å°†å‘¨è¾¹çš„åƒç´ ç¿»è½¬è¿‡å»æˆ–è€…é‡‡ç”¨äº†ä»€ä¹ˆæ›´ä¸ºç¥å¥‡é«˜ç«¯çš„ç®—æ³•çŒœæµ‹å¼¥è¡¥äº†å›¾ç‰‡ä»¥è¿›è¡Œé«˜æ–¯æ¨¡ç³Šã€‚ï¼ˆå› ä¸ºçœ‹ä¸åˆ°æºç ï¼Œæ‰€ä»¥åªèƒ½çŒœçŒœäº†ã€‚ï¼‰

## å®è·µ

æˆ‘ä»¬ä¸å¦¨è‡ªå·±æ¥å®ç°ä¸€ä¸‹ï¼ˆç›´æ¥ç”¨ HTML5 çš„ Canvas æ¯”è¾ƒæ–¹ä¾¿ï¼‰ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½è¾¾æˆç›¸ä¼¼çš„æ•ˆæœã€‚

è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œå…ä¸äº†è¦å†™ä¸€äº›è¿ç®—ã€‚è­¬å¦‚å°†é«˜æ–¯åˆ†å¸ƒå¾—åˆ°çš„æƒé‡çŸ©é˜µï¼Œå’Œæ¨¡ç³ŠåŠå¾„æ„æˆçš„åƒç´ çŸ©é˜µè¿›è¡Œç‚¹ä¹˜ï¼Œæœ€åæ±‚å’Œï¼Œå¾—åˆ°æ¨¡ç³Šåçš„åƒç´ ã€‚è™½ç„¶éå†çš„æ—¶å€™å°±é¡ºå¸¦æ±‚å’Œæ›´è¿…é€Ÿï¼Œä¸è¿‡æ‹†åˆ†æˆç‚¹ä¹˜å’Œæ±‚å’Œï¼Œæ›´æ–¹ä¾¿ç†è§£ä¸€äº›ï¼Œä¹Ÿèƒ½ä½¿ç”¨ä¸€ä¸‹ç°æˆçš„åº“ã€‚

> [Matrix math for the web](https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API/Matrix_math_for_the_web)

- [mathjs](https://github.com/josdejong/mathjs): JavaScript æ•°å­¦æ‰©å±•åº“
- [gl-matrix](https://github.com/toji/gl-matrix): ï¼ˆMDN ä¸Šé’¦ç‚¹çš„ï¼‰é«˜æ€§èƒ½ WebGL åº”ç”¨ç¨‹åºçš„ Javascript çŸ©é˜µå’ŒçŸ¢é‡åº“ï¼ˆä¸è¿‡çœ‹èµ·æ¥åŸç”Ÿæ”¯æŒä¼˜åŒ–äº† 2/3/4 ç»´çŸ©é˜µï¼Œä¸»è¦ç”¨äº WebGLï¼Œä½†æ˜¯æˆ‘ä»¬æ¨¡ç³Šæ—¶çš„çŸ©é˜µç»´æ•°æ ¹æ®æ¨¡ç³ŠåŠå¾„å¯èƒ½å¾ˆå¤§ï¼Œæ‰€ä»¥åº”è¯¥ç”¨ä¸åˆ°ã€‚~~è‡³äºæ‹†åˆ†çŸ©é˜µï¼Œä¸å¦‚ç›´æ¥å†™å®Œæ•´çš„çŸ©é˜µæ›´æ˜“äºç†è§£å’Œå®ç°~~ï¼‰

### é«˜æ–¯çŸ©é˜µ

æ¯æ¬¡éƒ½å»è®¡ç®—é«˜æ–¯åˆ†å¸ƒæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å…ˆæ ¹æ®æ¨¡ç³ŠåŠå¾„ç®—å‡ºä¸€ä¸ªæƒé‡çŸ©é˜µï¼Œåç»­ç›´æ¥ç”¨æ¥è®¡ç®—å³å¯ã€‚

ä»ç»´åŸºç™¾ç§‘å·ä¸€ä¸ªé«˜æ–¯çŸ©é˜µï¼ˆÏƒ = 0.84089642ï¼‰7\*7 ç¤ºä¾‹ï¼š

|            |            |            |            |            |            |            |
| ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- |
| 0.00000067 | 0.00002292 | 0.00019117 | 0.00038771 | 0.00019117 | 0.00002292 | 0.00000067 |
| 0.00002292 | 0.00078633 | 0.00655965 | 0.01330373 | 0.00655965 | 0.00078633 | 0.00002292 |
| 0.00019117 | 0.00655965 | 0.05472157 | 0.11098164 | 0.05472157 | 0.00655965 | 0.00019117 |
| 0.00038771 | 0.01330373 | 0.11098164 | 0.22508352 | 0.11098164 | 0.01330373 | 0.00038771 |
| 0.00019117 | 0.00655965 | 0.05472157 | 0.11098164 | 0.05472157 | 0.00655965 | 0.00019117 |
| 0.00002292 | 0.00078633 | 0.00655965 | 0.01330373 | 0.00655965 | 0.00078633 | 0.00002292 |
| 0.00000067 | 0.00002292 | 0.00019117 | 0.00038771 | 0.00019117 | 0.00002292 | 0.00000067 |

ä¸€ç»´æ­£æ€åˆ†å¸ƒï¼š

$$ {\displaystyle f(x)={\frac {1}{\sigma {\sqrt {2\pi }}}}e^{-{\frac {\left(x-\mu \right)^{2}}{2\sigma ^{2}}}}} $$

> Î¼ æ˜¯ x çš„å‡å€¼ï¼Œ$Ïƒ^2$ æ˜¯ x çš„æ–¹å·®ã€‚è®°ä½œ $X \sim N(Î¼,Ïƒ^2)$ã€‚

å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ä¸­å¿ƒç‚¹ä½œä¸ºåŸç‚¹ï¼Œé‚£ä¹ˆå‡å€¼ Î¼ ä¾¿å– 0ã€‚ï¼ˆå– 1 çš„æ—¶å€™ä¾¿æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚ï¼‰
ä½†çœ‹äº†å¥½å¤šæ–‡ç« ï¼ˆå‘ç°å¾ˆå¤šæœ€åéƒ½æ˜¯æŠ„è‡ªé˜®ä¸€å³°çš„é‚£ç¯‡â€¦â€¦ï¼‰ï¼Œéƒ½æ˜¯ç›´æ¥å‡å®š Ïƒ ä¸ºæŸä¸€ä¸ªæ•°å€¼ï¼Œå´æ²¡æœ‰è¯´æ˜åŸå› ã€‚

è€Œ OpenCV æºç ä¸­åˆ™å½“æ²¡æœ‰è®¾ç½® Ïƒ æˆ– Ïƒ ä¸åˆæ³•æ—¶ï¼ŒæŒ‰ç…§ $Ïƒ=0.3\*((ksize-1)\*0.5-1)+0.8$ è®¡ç®—å¾—å‡ºã€‚è€Œè¿™ä¸ª ksize æ­£æ˜¯ä¸­å¿ƒç‚¹åƒç´ åŠå‘¨è¾¹åƒç´ çš„çŸ©é˜µçš„å°ºå¯¸ï¼Œå³ 2\*æ¨¡ç³ŠåŠå¾„+1ã€‚ï¼ˆOpenCV æ–‡æ¡£ä¸­ä¹Ÿè¯´æ˜å…¶åº”å½“æ˜¯ä¸€ä¸ªå¥‡æ•°ï¼Œå°è¯äº†è¿™ä¸€è§‚ç‚¹ã€‚ï¼‰

> [getGaussianKernel()](https://docs.opencv.org/master/d4/d86/group__imgproc__filter.html#gac05a120c1ae92a6060dd0db190a61afa)

N ç»´ç©ºé—´æ­£æ€åˆ†å¸ƒæ–¹ç¨‹ï¼š

$$ G(r) = \frac{1}{\sqrt{2\pi \sigma^2}^N} e^{-r^2/(2 \sigma^2)} $$

äºŒç»´ç©ºé—´ä¸­çš„é«˜æ–¯åˆ†å¸ƒï¼š

$$ G(u,v) = \frac{1}{2\pi \sigma^2} e^{-(u^2 + v^2)/(2 \sigma^2)} $$

> $$ r^2 = u^2 + v^2 $$

---

> ç†è®ºä¸Šæ¥è®²ï¼Œå›¾åƒä¸­æ¯ç‚¹çš„åˆ†å¸ƒéƒ½ä¸ä¸ºé›¶ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªåƒç´ çš„è®¡ç®—éƒ½éœ€è¦åŒ…å«æ•´å¹…å›¾åƒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåœ¨è®¡ç®—é«˜æ–¯å‡½æ•°çš„ç¦»æ•£è¿‘ä¼¼æ—¶ï¼Œåœ¨å¤§æ¦‚ 3Ïƒ è·ç¦»ä¹‹å¤–çš„åƒç´ éƒ½å¯ä»¥çœ‹ä½œä¸èµ·ä½œç”¨ï¼Œè¿™äº›åƒç´ çš„è®¡ç®—ä¹Ÿå°±å¯ä»¥å¿½ç•¥ã€‚é€šå¸¸ï¼Œå›¾åƒå¤„ç†ç¨‹åºåªéœ€è¦è®¡ç®— $(6 \sigma + 1) \times (6 \sigma + 1)$ çš„çŸ©é˜µå°±å¯ä»¥ä¿è¯ç›¸å…³åƒç´ å½±å“ã€‚å¯¹äºè¾¹ç•Œä¸Šçš„ç‚¹ï¼Œé€šå¸¸é‡‡ç”¨å¤åˆ¶å‘¨å›´çš„ç‚¹åˆ°å¦ä¸€é¢å†è¿›è¡ŒåŠ æƒå¹³å‡è¿ç®—ã€‚ â€”â€”æ‘˜è‡ªç»´åŸºç™¾ç§‘

è®¾ã€Œæ¨¡ç³ŠåŠå¾„ã€ä¸º `r`ï¼Œ$\sigma=0.3*(r - 1)+0.8$ è¿™ä¹ˆå–åº”å½“ä¾¿æ˜¯ä¸ºäº†é¿å…è®¡ç®—ä¸€äº›å‡ ä¹æ— ç”¨çš„æ•°å€¼ã€‚

> å¯¹ä¸€å¹…å›¾åƒè¿›è¡Œå¤šæ¬¡è¿ç»­é«˜æ–¯æ¨¡ç³Šçš„æ•ˆæœä¸ä¸€æ¬¡æ›´å¤§çš„é«˜æ–¯æ¨¡ç³Šå¯ä»¥äº§ç”ŸåŒæ ·çš„æ•ˆæœï¼Œå¤§çš„é«˜æ–¯æ¨¡ç³Šçš„åŠå¾„æ˜¯æ‰€ç”¨å¤šä¸ªé«˜æ–¯æ¨¡ç³ŠåŠå¾„å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨åŠå¾„åˆ†åˆ«ä¸º 6 å’Œ 8 çš„ä¸¤æ¬¡é«˜æ–¯æ¨¡ç³Šå˜æ¢å¾—åˆ°çš„æ•ˆæœç­‰åŒäºä¸€æ¬¡åŠå¾„ä¸º 10 çš„é«˜æ–¯æ¨¡ç³Šæ•ˆæœï¼Œ$\sqrt{6\times6 + 8\times8} = 10$ ã€‚æ ¹æ®è¿™ä¸ªå…³ç³»ï¼Œä½¿ç”¨å¤šä¸ªè¿ç»­è¾ƒå°çš„é«˜æ–¯æ¨¡ç³Šå¤„ç†ä¸ä¼šæ¯”å•ä¸ªé«˜æ–¯è¾ƒå¤§å¤„ç†æ—¶é—´è¦å°‘ã€‚

æ­¤å¤–å› ä¸ºç¼©å°çŸ©é˜µå¤šæ¬¡å¤„ç†å¹¶ä¸ä¼šå‡å°‘å¤„ç†æ—¶é—´ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä¸Šæ‰‹å§ï¼

TypeScript ä»£ç ï¼š

```typescript
// ç”¨äº†é‡Œé¢çš„çŸ©é˜µï¼ˆè™½ç„¶è‡ªå·±éå†ä¹Ÿè¡Œï¼‰
import * as math from 'mathjs'
/**
 * è®¡ç®—é«˜æ–¯æƒé‡æ•°å€¼
 * @param x Xåæ ‡
 * @param y Yåæ ‡
 * @param sigma
 */
function calculateGaussianWeight(x: number, y: number, sigma: number) {
  const PI = Math.PI
  // æ–¹å·®
  const variance = sigma * sigma
  const weight
    = (1 / (2 * PI * variance)) * Math.exp(-(x * x + y * y) / (2 * variance))
  return weight
}

/**
 * ç”Ÿæˆé«˜æ–¯çŸ©é˜µ
 * @param radius æ¨¡ç³ŠåŠå¾„
 * @param sigma Ïƒ 0.3*(radius - 1)+0.8
 */
export function generateGaussianMatrix(radius: number, sigma?: number) {
  if (!sigma) {
    sigma = 0.3 * (radius - 1) + 0.8
  }

  // çŸ©é˜µå°ºå¯¸
  const mSize = radius * 2 + 1
  let gMatrix = math.matrix(math.ones(mSize, mSize))

  gMatrix.forEach((val, index) => {
    const x = index[0] - radius
    const y = index[1] - radius
    gMatrix.set(index as any, calculateGaussianWeight(x, y, sigma))
  })

  gMatrix = normalization(gMatrix)
  return gMatrix
}
```

### å½’ä¸€åŒ–

```typescript
/**
 * å½’ä¸€åŒ–
 * @param matrix
 */
function normalization(matrix: math.Matrix) {
  const sum = math.sum(matrix)
  return math.divide(matrix, sum) as math.Matrix
}
```

### é«˜æ–¯åŠ æƒæ±‚å’Œ

[Uint8ClampedArray](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray): ç±»å‹åŒ–æ•°ç»„è¡¨ç¤ºä¸€ä¸ªç”±å€¼å›ºå®šåœ¨ 0-255 åŒºé—´çš„ 8 ä½æ— ç¬¦å·æ•´å‹ç»„æˆçš„æ•°ç»„ï¼›å¦‚æœä½ æŒ‡å®šä¸€ä¸ªåœ¨ [0,255] åŒºé—´å¤–çš„å€¼ï¼Œå®ƒå°†è¢«æ›¿æ¢ä¸º 0 æˆ– 255ï¼›å¦‚æœä½ æŒ‡å®šä¸€ä¸ªéæ•´æ•°ï¼Œé‚£ä¹ˆå®ƒå°†è¢«è®¾ç½®ä¸ºæœ€æ¥è¿‘å®ƒçš„æ•´æ•°ã€‚

```typescript
export function blur(
  imageData: ImageData,
  width: number,
  height: number,
  options: BlurOptions
) {
  const data = imageData.data
  const originData = new Uint8ClampedArray(imageData.data)

  /**
   * è·å–åƒç´ 
   * @param x
   * @param y
   */
  function getPixel(x: number, y: number) {
    if (x < 0 || x >= height || y < 0 || y >= width) {
      return [0, 0, 0, 0]
    }
    else {
      const p = (x * width + y) * 4
      return originData.subarray(p, p + 4)
    }
  }

  const gMatrix = generateGaussianMatrix(
    options.radius,
    options.sigma ? options.sigma : null
  )

  const radius = options.radius

  let i = 0
  for (let x = 0; x < height; x++) {
    for (let y = 0; y < width; y++) {
      let r = 0
      let g = 0
      let b = 0
      let a = 0
      gMatrix.forEach((val, index) => {
        const dx = index[0] - radius
        const dy = index[1] - radius

        const pixel = getPixel(x + dx, y + dy)
        r += val * pixel[0]
        g += val * pixel[1]
        b += val * pixel[2]
        a += val * pixel[3]
      })
      data.set([r, g, b, a], i)
      i += 4
    }
  }
  return imageData
}
```

éå†å›¾ç‰‡ä¸­çš„æ¯ä¸ªåƒç´ ï¼Œå¹¶æŒ‰ç…§é«˜æ–¯æƒé‡çŸ©é˜µè¿›è¡Œè®¡ç®—ã€‚ç»˜åˆ¶å‡ºè®¡ç®—åçš„å›¾åƒã€‚

å¥½ï¼Œæ”¶å·¥ã€‚

- å®Œæ•´ç¤ºä¾‹ä»£ç è§ [gaussian-blur](https://github.com/YunYouJun/gaussian-blur)
- åœ¨çº¿åœ°å€è§ï¼š[Gaussian Blur Demo](https://www.yunyoujun.cn/gaussian-blur/)

![gaussian-blur-30px-137007ms](https://r2.yunyoujun.cn/images/gaussian-blur-30px-137007ms.jpg)

emmmï¼Œå¯æ˜¯é€Ÿåº¦å¾ˆæ…¢ï¼Œ1119\*559 æ¨¡ç³ŠåŠå¾„ 30px ä¾¿èŠ±äº†è¶³è¶³ 137007msã€‚ï¼ˆMacBook Pro 15-inch 2019ï¼‰

### ä¼˜åŒ–ï¼Ÿ

æœ¬æ¥æ²¡æ‰“ç®—æœ‰è¿™ä¸ªç¯èŠ‚ï¼Œä½†æ˜¯å‘ç°çº¯ç²¹æŒ‰ç…§é«˜æ–¯æ¨¡ç³Šæœ¬èº«çš„æ€è·¯æ¥å†™ï¼Œå®åœ¨æ˜¯æ…¢åˆ°ä¸å¯æ€è®®ã€‚

æˆ‘ä»¬æ¥å¯»æ‰¾æ˜¯å¦æœ‰æ›´è¿…é€Ÿçš„æ–¹æ¡ˆè¾¾æˆç±»ä¼¼çš„æ•ˆæœã€‚

é¦–å…ˆè¿™ä¸ªé«˜æ–¯çŸ©é˜µæ˜¯æ ¹æ®åæ ‡æ¥è¿›è¡Œè®¡ç®—çš„ï¼Œæ‰€ä»¥å·¦ä¸Šã€å·¦ä¸‹ã€å³ä¸Šã€å³ä¸‹çš„æ•°å€¼ç¿»è½¬åå…¶å®æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚
æ‰€ä»¥è¿™æœŸé—´æ¯ä¸ªåƒç´ æœ‰å¾ˆå¤šé‡å¤è®¡ç®—å¯ä»¥ç¼“å­˜ä¸‹æ¥ä»¥ä¼˜åŒ–ã€‚ï¼ˆä½†æ˜¯å› ä¸ºå¤ªæ‡’ï¼Œæˆ‘å°±ä¸å†™æ¥â€¦â€¦ï¼‰

çœ‹åˆ° [åŸºäº Canvas å®ç°çš„é«˜æ–¯æ¨¡ç³Š](https://zhuanlan.zhihu.com/p/98356516) æåˆ°å¯ä»¥å°†é«˜æ–¯æ¨¡ç³Šä½¿ç”¨ä¸€ç»´çš„é«˜æ–¯å‡½æ•°åˆ†åˆ«å¯¹ x å’Œ y è½´è¿›è¡Œè¿ç®—ä»¥ä¼˜åŒ–é€Ÿåº¦ï¼Œä½†ä»æ—§è¿˜æ˜¯æœ‰ç‚¹æ…¢çš„ã€‚

æ­¤å¤–è¿˜å¯ä»¥ç¼©å°å›¾ç‰‡ã€é—´éš”æŒ‡å®šæ•°é‡çš„åƒç´ å»è®¡ç®—ç­‰ã€‚

è€Œåœ¨ CodePen ä¸Šå‘ç°äº†ä¸€ä¸ª [canvas Blur](https://codepen.io/zhaojun/pen/zZmRQe) å‡ ä¹å¯ä»¥ç«‹å³å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚

å…¶ä»£ç ä¹Ÿä¸å¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ç¨å¾®ä¼˜åŒ–ä¸€ä¸‹ã€‚ï¼ˆå…¶å®å°±æ˜¯æ”¹æˆå…ˆæŠŠçŸ©é˜µç®—å‡ºæ¥ã€‚ï¼‰

```typescript
// å¤ç”¨è®¡ç®—é«˜æ–¯æƒé‡çš„å‡½æ•°
import { calculateGaussianWeight } from './index'
export class Blur {
  radius: number
  canvas: HTMLCanvasElement
  ctx: CanvasRenderingContext2D
  constructor(options: BlurOptions) {
    this.radius = options.radius || 3
  }

  initCanvas(canvas: HTMLCanvasElement) {
    this.canvas = canvas
    this.ctx = canvas.getContext('2d')
  }

  gaussianBlur() {
    const radius = this.radius
    const canvas = this.canvas
    const ctx = this.ctx

    // çŸ©é˜µå°ºå¯¸
    const mSize = radius * 2 + 1
    const gMatrix = math.matrix(math.ones(mSize, mSize))

    let sum = 0
    const sigma = 0.3 * (radius - 1) + 0.8
    const step = radius < 3 ? 1 : 2

    // è·³ç€è®¡ç®—å‡ºé«˜æ–¯æƒé‡ï¼ˆæ‰€ä»¥æ€»å’Œä¸ä¸€æ ·ï¼‰
    for (let y = -radius; y <= radius; y += step) {
      for (let x = -radius; x <= radius; x += step) {
        const weight = calculateGaussianWeight(x, y, sigma)
        gMatrix.set([x + radius, y + radius], weight)
        sum += weight
      }
    }

    // ç»˜åˆ¶ä¸åŒé€æ˜åº¦çš„åŸå›¾ï¼Œå¹¶åç§»ä¸åŒä½ç½®ï¼Œå åŠ åˆ°åŸå›¾ä¸Šã€‚
    for (let y = -radius; y <= radius; y += step) {
      for (let x = -radius; x <= radius; x += step) {
        ctx.globalAlpha
          = (gMatrix.get([x + radius, y + radius]) / sum) * radius
        ctx.drawImage(canvas, x, y)
      }
    }

    ctx.globalAlpha = 1
  }
}
```

![Gaussian Blur Demo](https://r2.yunyoujun.cn/images/gaussian-blur-demo.jpg)

å¾ˆç¥å¥‡åœ°ä¹Ÿèƒ½å®ç°ç±»ä¼¼æ•ˆæœï¼Œä½†æ¨¡ç³Šç¨‹åº¦è¿˜æ˜¯ç•¥æœ‰ä¸åŒçš„ã€‚ï¼ˆå¯ä»¥çœ‹åˆ° Canvas çš„é«˜æ–¯æ¨¡ç³Šä¹Ÿæ˜¯æœ‰ç™½è¾¹çš„ã€‚ï¼‰

![Fast Gaussian Blur 100px](https://r2.yunyoujun.cn/images/fast-gaussian-blur-100px-1043ms.jpg)_100px 1043ms_

ä¸è¿‡å¥½åƒæœ‰ç‚¹ç»ç’ƒä¸Šæœ‰æ°´æ»´æµä¸‹æ¥çš„é‚£ç§æ„Ÿè§‰ã€‚

## ç»“è®º

å½“ç„¶æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨ Canvas ä¸­ filter çš„æ¨¡ç³Šè¦æ›´å¿«ã€‚ï¼ˆè€Œ CSS çš„ filter ç™½è¾¹é—®é¢˜æˆ‘ä»¬ä»æ—§æ— æ³•ä»åº•å±‚è§£å†³ã€‚ï¼‰

æœ€åä¸€ç§æ–¹æ³•å¯ä»¥è¿…é€Ÿè·å¾—è¿˜ä¸é”™çš„æ¨¡ç³Šæ•ˆæœï¼Œå¹¶æ¶ˆé™¤æ‰€è°“çš„ç™½è¾¹ã€‚ï¼ˆè€ŒåŸç”Ÿçš„é«˜æ–¯æ¨¡ç³Šç®—æ³•åœ¨æ²¡æœ‰ä¼˜åŒ–çš„æƒ…å†µä¸‹åˆ™å®Œå…¨ä¸èƒ½ç”¨äºç”Ÿäº§ã€‚ï¼‰

## Reference

- [Gaussian blur | WIKIPEDIA](https://en.wikipedia.org/wiki/Gaussian_blur)
- [é«˜æ–¯æ¨¡ç³Šçš„ç®—æ³• | é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](http://www.ruanyifeng.com/blog/2012/11/gaussian_blur.html)

## åè¯

è™½ç„¶èµ·åˆæƒ³ç€å®ç°èµ·æ¥åº”è¯¥ä¸ä¼šå¤ªéš¾ï¼Œä½†ä»æ—§ç²—å¿ƒå¤§æ„è¸©äº†äº›å‘ï¼Œä¹ŸèŠ±äº†ä¸å°‘çš„æ—¶é—´ã€‚å¸Œæœ›ä¹Ÿèƒ½å¸®åŠ©å¤§å®¶åŠ æ·±ä¸€äº›ç†è§£å§ã€‚
éš¾å¾—æ°´äº†ä¸€ç¯‡æŠ€æœ¯ç±»æ–‡ç« ï¼Œå› ä¸ºå †ç§¯çš„å…¶ä»–äº‹åŠ¡æ¯”è¾ƒå¤šï¼Œè¶…å‡ºäº†è‡ªå·±é¢„æƒ³çš„æ—¶é—´ï¼Œæœ€åæœ‰ç‚¹è‰è‰ç»“å°¾ï¼Œè¿˜è¯·è§è°…ã€‚
å¦‚æœ‰è°¬è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚

---

Q.E.D.
